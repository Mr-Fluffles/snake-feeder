<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Danger Noodle Tracker</title>
    <style>
        :root {
            --bg: #C8E6C9;
            --card: #1e1e1e;
            --text: #e0e0e0;
            --accent: #00e676;
            --danger: #ff5252;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            transition: background 0.5s ease;
            
            /* --- THE FIX: ALLOW SCROLLING --- */
            overflow-y: auto; 
            touch-action: manipulation; 
            padding-bottom: 50px; /* Extra space at bottom for scrolling */
        }
        
        /* HOLOGRAPHIC THEME ANIMATION */
        body.holo-theme {
            background: linear-gradient(270deg, #ff9a9e, #fad0c4, #fad0c4, #a18cd1, #fbc2eb);
            background-size: 800% 800%;
            animation: holoGradient 10s ease infinite;
        }
        @keyframes holoGradient {
            0%{background-position:0% 50%}
            50%{background-position:100% 50%}
            100%{background-position:0% 50%}
        }

        .container {
            background: var(--card);
            padding: 2rem;
            border-radius: 20px;
            width: 85%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
            transition: transform 1s, opacity 0.5s;
            margin-top: 20px; /* Ensure space at top */
        }
        h1 { margin-top: 0; font-size: 1.8rem; }
        .emoji { font-size: 3rem; display: block; margin-bottom: 10px; }
        
        .input-group { 
            margin: 15px 0; 
            font-size: 1.1rem; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .status {
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 10px;
            font-weight: bold;
        }
        button {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); }
        button.secondary {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            margin-top: 20px;
        }

        /* GAME BUTTON STYLE */
        .game-btn {
            background: #ff9800; /* Orange */
            color: white;
            margin-bottom: 20px;
        }
        
        input[type="number"], input[type="time"] {
            background: #333;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            width: 60px;
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .theme-label { margin-top: 30px; font-size: 0.9rem; color: #888; margin-bottom: 10px; display: block; }
        .pastel-swatches { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .swatch { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; }
        .manual-picker-wrapper { display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.8rem; color: #666; }
        input[type="color"] { border: none; width: 30px; height: 30px; cursor: pointer; background: none; border-radius: 50%; }
        
        /* THE GLITCH TRAP */
        .forbidden-btn {
            background-color: #220000;
            color: #ff3333;
            font-family: "Courier New", monospace;
            font-size: 0.7rem;
            padding: 10px;
            margin-top: 50px;
            border: 1px solid #ff0000;
            border-radius: 5px;
            opacity: 0;
            animation: reveal 2s forwards, glitch-shake 4s infinite;
            animation-delay: 3s; 
            cursor: help;
            box-shadow: 0 0 5px #ff0000;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative; 
            z-index: 100;
        }
        
        @keyframes reveal { from { opacity: 0; } to { opacity: 0.8; } }
        @keyframes glitch-shake {
            0% { transform: translate(0, 0); } 90% { transform: translate(0, 0); }
            92% { transform: translate(-2px, 2px); } 94% { transform: translate(2px, -2px); }
            96% { transform: translate(-2px, -2px); } 98% { transform: translate(2px, 2px); }
            100% { transform: translate(0, 0); }
        }

        /* CHAOS MODE */
        body.chaos {
            background-image: url('https://media.giphy.com/media/M7gtacN7aPNsc/giphy.gif');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            animation: rainbow-flash 0.2s infinite;
        }
        .container.chaos-spin { animation: spin 3s infinite linear; border: 5px solid hotpink; }
        @keyframes rainbow-flash { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* GAME CANVAS STYLES */
        canvas {
            display: none;
            position: fixed; /* Fixed so it covers screen even if scrolled */
            top: 0;
            left: 0;
            z-index: 50;
            background: rgba(0,0,0,0.85);
            /* Lock touch actions ONLY on the game canvas */
            touch-action: none;
        }
        
        /* Stop scrolling ONLY when game is active class is added */
        body.game-active {
            overflow: hidden;
        }

        .game-overlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #000;
            padding: 20px;
            border-radius: 15px;
            z-index: 60;
            text-align: center;
            width: 80%;
            max-width: 300px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .coupon {
            border: 3px dashed #333;
            background: #fffbe6;
            padding: 15px;
            margin-top: 10px;
            font-family: "Courier New", monospace;
            color: #333;
            transform: rotate(-2deg);
        }
        
        .control-hint {
            position: fixed;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 0.8rem;
            z-index: 55;
            display: none;
            pointer-events: none;
        }

        .small-text { font-size: 0.8rem; color: #888; margin-top: 10px;}
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div class="control-hint" id="gameHint">Tap LEFT or RIGHT to move</div>

<div class="game-overlay" id="msgOverlay">
    <h2 id="msgTitle">Game Over</h2>
    <p id="msgBody">You ate the fruitcake.</p>
    <div id="couponBox" class="coupon" style="display:none;">
        <h3>üéüÔ∏è OFFICIAL COUPON üéüÔ∏è</h3>
        <p><b>Luthy</b> owes me one free trip to the pet store to buy frozen mice.</p>
        <small>Valid forever.</small>
    </div>
    <button onclick="resetGame()" id="retryBtn" style="margin-top:15px;">Try Again</button>
    <button onclick="closeGame()" id="closeBtn" class="secondary" style="margin-top:10px; display:none;">Main Menu</button>
</div>

<div class="container" id="mainCard">
    <span class="emoji">üêç</span>
    <h1 id="titleText">Danger Noodle Tracker</h1>
    
    <button class="game-btn" onclick="initGame()">ü¶É Catch The Dinner</button>

    <div class="input-group">
        Every <input type="number" id="interval" value="21"> days
    </div>
    <div class="input-group">
        At <input type="time" id="feedTime" value="09:00">
    </div>

    <div class="status" id="statusDisplay">Loading...</div>

    <button onclick="feedSnake()">I Fed The Snek!</button>
    <button class="secondary" onclick="addToCalendar()">üìÖ Set Recurring Alarm</button>

    <p class="small-text" id="lastFedText"></p>

    <span class="theme-label">Choose a Vibe:</span>
    <div class="pastel-swatches" id="swatchContainer">
        <div class="swatch" style="background: #C8E6C9;" onclick="setTheme('#C8E6C9')"></div>
        <div class="swatch" style="background: #E1BEE7;" onclick="setTheme('#E1BEE7')"></div>
        <div class="swatch" style="background: #B3E5FC;" onclick="setTheme('#B3E5FC')"></div>
        <div class="swatch" style="background: #FFCCBC;" onclick="setTheme('#FFCCBC')"></div>
        <div class="swatch" style="background: #F8BBD0;" onclick="setTheme('#F8BBD0')"></div>
    </div>
    <div class="manual-picker-wrapper">
        or custom: <input type="color" id="bgPicker" value="#C8E6C9">
    </div>

    <button class="forbidden-btn" onclick="activateChaos()">‚ö†Ô∏è Admin Debug Mode<br>(Do Not Touch)</button>
</div>

<script>
    // --- APP STATE ---
    const savedInterval = localStorage.getItem('interval');
    const savedColor = localStorage.getItem('themeColor');
    const savedTime = localStorage.getItem('feedTime');
    const goldUnlocked = localStorage.getItem('goldUnlocked');
    const holoUnlocked = localStorage.getItem('holoUnlocked');

    // --- INIT ---
    if (savedInterval) document.getElementById('interval').value = savedInterval;
    if (savedTime) document.getElementById('feedTime').value = savedTime;
    
    const initialColor = savedColor || '#C8E6C9';
    if(initialColor === 'holo') {
        document.body.classList.add('holo-theme');
    } else {
        setTheme(initialColor, false);
    }
    
    updateDisplay();
    
    if(goldUnlocked === 'true') addGoldSwatch();
    if(holoUnlocked === 'true') addHoloSwatch();

    // --- THEME LOGIC ---
    document.getElementById('bgPicker').addEventListener('input', function(e) { setTheme(e.target.value); });

    function setTheme(color, save = true) {
        document.body.classList.remove('holo-theme'); 
        document.documentElement.style.setProperty('--bg', color);
        document.getElementById('bgPicker').value = color;
        if (save) localStorage.setItem('themeColor', color);
    }

    function setHolo(save = true) {
        document.body.classList.add('holo-theme');
        if(save) localStorage.setItem('themeColor', 'holo');
    }

    function addGoldSwatch() {
        if(document.getElementById('goldSwatch')) return;
        const swatchContainer = document.getElementById('swatchContainer');
        const goldBtn = document.createElement('div');
        goldBtn.id = 'goldSwatch';
        goldBtn.className = 'swatch';
        goldBtn.style.background = 'linear-gradient(135deg, #FFD700, #FDB931)';
        goldBtn.style.border = '2px solid #fff';
        goldBtn.onclick = function() { setTheme('#FFD700'); };
        swatchContainer.appendChild(goldBtn);
    }

    function addHoloSwatch() {
        if(document.getElementById('holoSwatch')) return;
        const swatchContainer = document.getElementById('swatchContainer');
        const holoBtn = document.createElement('div');
        holoBtn.id = 'holoSwatch';
        holoBtn.className = 'swatch';
        holoBtn.style.background = 'linear-gradient(135deg, #fbc2eb, #a6c1ee)';
        holoBtn.style.border = '2px solid #fff';
        holoBtn.title = "Holographic";
        holoBtn.onclick = function() { setHolo(); };
        swatchContainer.appendChild(holoBtn);
    }

    // --- STANDARD APP FUNCTIONS ---
    function feedSnake() {
        const now = new Date();
        localStorage.setItem('lastFed', now.toISOString());
        localStorage.setItem('interval', document.getElementById('interval').value);
        localStorage.setItem('feedTime', document.getElementById('feedTime').value);
        updateDisplay();
    }

    function updateDisplay() {
        const lastFed = localStorage.getItem('lastFed');
        const interval = parseInt(document.getElementById('interval').value) || 21;
        const statusDiv = document.getElementById('statusDisplay');
        const lastFedText = document.getElementById('lastFedText');

        if (!lastFed) {
            statusDiv.innerHTML = "‚ö†Ô∏è No data. Feed the noodle!";
            statusDiv.style.color = "var(--danger)";
            return;
        }
        const lastDate = new Date(lastFed);
        const nextDate = new Date(lastDate);
        nextDate.setDate(lastDate.getDate() + interval);
        const today = new Date();
        today.setHours(0,0,0,0);
        const tempNext = new Date(nextDate);
        tempNext.setHours(0,0,0,0);
        const diffTime = tempNext - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        lastFedText.innerText = "Last fed: " + lastDate.toLocaleDateString();
        if (diffDays <= 0) {
            statusDiv.innerHTML = "üçΩÔ∏è FEED ME NOW!";
            statusDiv.style.color = "var(--danger)";
        } else {
            statusDiv.innerHTML = `Next feed in <b>${diffDays} days</b>`;
            statusDiv.style.color = "var(--accent)";
        }
    }

    function addToCalendar() {
        const interval = parseInt(document.getElementById('interval').value) || 21;
        const timeVal = document.getElementById('feedTime').value || "09:00";
        const lastFed = localStorage.getItem('lastFed') ? new Date(localStorage.getItem('lastFed')) : new Date();
        const nextFeed = new Date(lastFed);
        nextFeed.setDate(nextFeed.getDate() + interval);
        const year = nextFeed.getFullYear();
        const month = (nextFeed.getMonth() + 1).toString().padStart(2, '0');
        const day = nextFeed.getDate().toString().padStart(2, '0');
        const timeParts = timeVal.split(':');
        const fullDateTime = `${year}${month}${day}T${timeParts[0]}${timeParts[1]}00`;

        const icsMsg = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
DTSTART:${fullDateTime}
RRULE:FREQ=DAILY;INTERVAL=${interval}
SUMMARY:üêç Feed the Danger Noodle
DESCRIPTION:Repeats every ${interval} days.
BEGIN:VALARM
TRIGGER:-PT0M
ACTION:DISPLAY
DESCRIPTION:Feeding Time!
END:VALARM
END:VEVENT
END:VCALENDAR`;

        const blob = new Blob([icsMsg], { type: 'text/calendar' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'snek-schedule.ics';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    }

    // --- GAME LOGIC ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let gameLoop;
    let score = 0;
    let isGameOver = false;
    let isPaused = false;
    let level = 1;

    let player = { x: 0, y: 0, width: 60, height: 60, icon: 'üêç' };
    let items = [];
    let frameCount = 0;

    function initGame() {
        document.getElementById('mainCard').style.display = 'none';
        
        // --- LOCK SCROLLING ONLY WHEN GAME STARTS ---
        document.body.classList.add('game-active');
        
        canvas.style.display = 'block';
        document.getElementById('gameHint').style.display = 'block';
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        player.x = canvas.width / 2 - player.width / 2;
        player.y = canvas.height - 100;
        
        score = 0;
        level = 1;
        items = [];
        isGameOver = false;
        isPaused = false;
        
        window.addEventListener('touchstart', handleTouch);
        window.addEventListener('mousedown', handleMouse);
        gameLoop = requestAnimationFrame(updateGame);
    }

    function handleTouch(e) { movePlayer(e.touches[0].clientX); }
    function handleMouse(e) { movePlayer(e.clientX); }
    
    function movePlayer(inputX) {
        if(inputX < canvas.width / 2) player.x -= 40;
        else player.x += 40;
        if(player.x < 0) player.x = 0;
        if(player.x > canvas.width - player.width) player.x = canvas.width - player.width;
    }

    function updateGame() {
        if (isGameOver || isPaused) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = "white";
        ctx.font = "30px Arial";
        ctx.fillText("Score: " + score, 20, 50);
        
        let color = "#00e676";
        if(level === 2) color = "#FFD700";
        if(level === 3) color = "#ff9a9e";
        ctx.fillStyle = color;
        ctx.font = "20px Arial";
        ctx.fillText("Level " + level, 20, 80);

        ctx.font = "50px Arial";
        ctx.fillText(player.icon, player.x, player.y + 50);

        frameCount++;
        
        let currentSpawnRate = 50;
        let speedMult = 1;
        let badThreshold = 0.2; 
        
        if (level === 2) { 
            currentSpawnRate = 40; 
            speedMult = 1.5; 
            badThreshold = 0.35; 
        }
        if (level === 3) { 
            currentSpawnRate = 25; 
            speedMult = 2.0; 
            badThreshold = 0.5; 
        }

        if(frameCount % currentSpawnRate === 0) {
            let type = 'good';
            let icon = 'ü¶É';
            
            if (Math.random() < badThreshold) {
                type = 'bad';
                icon = 'üçû'; 
            } else {
                const foods = ['ü¶É', 'ü•ß', 'üêÄ'];
                icon = foods[Math.floor(Math.random() * foods.length)];
            }
            
            let speed = (Math.random() * 3 + 3) * speedMult;

            items.push({
                x: Math.random() * (canvas.width - 50),
                y: -50,
                speed: speed,
                icon: icon,
                type: type
            });
        }

        for (let i = 0; i < items.length; i++) {
            let item = items[i];
            item.y += item.speed;
            ctx.fillText(item.icon, item.x, item.y + 50);
            
            if (item.x < player.x + player.width && item.x + 50 > player.x &&
                item.y < player.y + player.height && item.y + 50 > player.y) {
                if(item.type === 'bad') {
                    endGame("You ate the fruitcake! ü§¢");
                } else {
                    score++;
                    items.splice(i, 1);
                    i--;
                    checkLevelUp();
                }
            }
            if (item.y > canvas.height) { items.splice(i, 1); i--; }
        }
        gameLoop = requestAnimationFrame(updateGame);
    }

    function checkLevelUp() {
        if (score === 25 && level === 1) {
            isPaused = true;
            level = 2;
            localStorage.setItem('goldUnlocked', 'true');
            addGoldSwatch();
            setTheme('#FFD700'); 
            showModal("‚ú® GOLD UNLOCKED! ‚ú®", "New Theme Acquired!<br>Next Reward at 50!", false, true);
        }
        if (score === 50 && level === 2) {
            isPaused = true;
            level = 3;
            localStorage.setItem('holoUnlocked', 'true');
            addHoloSwatch();
            setHolo();
            showModal("üíé HOLO THEME UNLOCKED! üíé", "You are halfway to the Grand Prize!<br>WARNING: LEVEL 3 IS HARD.", false, true);
        }
        if (score === 75) {
            isGameOver = true;
            showModal("üéâ YOU WON! üéâ", "You survived the apocalypse.", true, false);
        }
    }

    function endGame(reason) {
        isGameOver = true;
        showModal("Game Over", reason + "<br>Score: " + score, false, false);
    }

    function showModal(title, body, isWin, isCheckpoint) {
        const overlay = document.getElementById('msgOverlay');
        const coupon = document.getElementById('couponBox');
        const retryBtn = document.getElementById('retryBtn');
        const closeBtn = document.getElementById('closeBtn');
        
        document.getElementById('msgTitle').innerText = title;
        document.getElementById('msgBody').innerHTML = body;
        overlay.style.display = 'block';
        
        coupon.style.display = 'none';
        closeBtn.style.display = 'none';

        if(isWin) {
            coupon.style.display = 'block';
            retryBtn.style.display = 'none';
            closeBtn.style.display = 'inline-block';
        } else if (isCheckpoint) {
            retryBtn.innerText = "Continue Level " + level;
            retryBtn.onclick = function() {
                overlay.style.display = 'none';
                isPaused = false;
                requestAnimationFrame(updateGame);
                retryBtn.innerText = "Try Again";
                retryBtn.onclick = resetGame;
            };
        } else {
            retryBtn.innerText = "Try Again";
            retryBtn.onclick = resetGame;
            closeBtn.style.display = 'inline-block';
        }
    }

    function resetGame() {
        document.getElementById('msgOverlay').style.display = 'none';
        score = 0;
        level = 1; 
        items = [];
        isGameOver = false;
        isPaused = false;
        player.x = canvas.width / 2 - player.width / 2;
        gameLoop = requestAnimationFrame(updateGame);
    }

    function closeGame() { location.reload(); }

    // --- CHAOS MODE ---
    let chaosAudio = null; 
    function activateChaos() {
        document.body.classList.add('chaos'); 
        document.getElementById('mainCard').classList.add('chaos-spin');
        document.getElementById('titleText').innerText = "HEYYEYAAEYAAAEYAEYAA";
        document.querySelector('.forbidden-btn').style.display = 'none';
        chaosAudio = new Audio('heman.mp3');
        chaosAudio.loop = true; 
        chaosAudio.volume = 1.0; 
        chaosAudio.play().catch(e => console.log("Audio blocked"));
        setTimeout(() => { alert("ü¶Ñ YOU TOUCHED THE FORBIDDEN BUTTON! ü¶Ñ"); }, 500);
    }
</script>

</body>
</html>
